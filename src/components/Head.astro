---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Head.astro';
---

<Default {...Astro.props}><slot /></Default>

<!-- TOC í† ê¸€ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
<script is:inline>
  // TOC í† ê¸€ ê¸°ëŠ¥
  function initTocToggle() {
    // í† ê¸€ ë²„íŠ¼ì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
    if (document.getElementById('toc-toggle')) {
      return;
    }

    // í† ê¸€ ë²„íŠ¼ ìƒì„±
    const toggleButton = document.createElement('button');
    toggleButton.id = 'toc-toggle';
    toggleButton.className = 'toc-toggle-button';
    toggleButton.setAttribute('aria-label', 'ëª©ì°¨ í† ê¸€');
    toggleButton.innerHTML = '<span class="toc-icon">ğŸ“‹</span><span class="toc-text">ëª©ì°¨</span>';

    document.body.appendChild(toggleButton);

    const body = document.body;

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ TOC ìƒíƒœ ë³µì›
    const tocHidden = localStorage.getItem('toc-hidden') === 'true';
    if (tocHidden) {
      body.classList.add('toc-hidden');
      updateButtonText(true);
    }

    // í† ê¸€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    toggleButton.addEventListener('click', () => {
      const isHidden = body.classList.toggle('toc-hidden');
      localStorage.setItem('toc-hidden', isHidden.toString());
      updateButtonText(isHidden);
    });

    function updateButtonText(isHidden) {
      const textElement = toggleButton.querySelector('.toc-text');
      if (textElement) {
        textElement.textContent = isHidden ? 'ëª©ì°¨ í‘œì‹œ' : 'ëª©ì°¨ ìˆ¨ê¹€';
      }
    }

    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì› (Ctrl/Cmd + \)
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === '\\') {
        e.preventDefault();
        toggleButton.click();
      }
    });
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTocToggle);
  } else {
    initTocToggle();
  }

  // Astroì˜ view transitionsë¥¼ ìœ„í•œ ì¬ì´ˆê¸°í™”
  document.addEventListener('astro:page-load', initTocToggle);
</script>

<style is:inline>
  .toc-toggle-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .toc-icon {
    font-size: 1.1rem;
  }

  .toc-text {
    font-size: 0.875rem;
  }

  /* ëª¨ë°”ì¼ì—ì„œëŠ” í…ìŠ¤íŠ¸ ìˆ¨ê¹€ */
  @media (max-width: 768px) {
    .toc-text {
      display: none;
    }
  }
</style>
